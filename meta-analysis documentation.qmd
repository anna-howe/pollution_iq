---
title: "Meta-analysis: Pollution and IQ"
author:
  name: "Anna Howe"
  affiliation: "University of Canterbury"
date-modified: last-modified
date: today

from: markdown+emoji
format:
  html:
    toc: true
    code-fold: false
    link-external-newwindow: true
theme:
  light: flatly
  dark: darkly
---

This page is designed to provide detail on the meta-analysis undertaken for the review "Air pollution (PM2.5 and NO2) exposure and child IQ: a systematic review and meta-analysis of prospective and longitudinal evidence"

# Meta-analysis Model Assumptions

## Fixed-effects model

Assumes that all effect sizes stem from a single, homogeneous population, i.e. all studies share the same true effect size. Thus any deviation from the overall effect size by any given study is because of sampling error. Hence why the effect is fixed. Can also be referred to as "equal effects" or "common effect".

Studeis with a small standard error, numerical representation of sampling error, should be better estimators of the true overall effect than studies with large standard errors. Pooled effects in mata-analyses give effect sizes with smaller standard errors (e.g. higer precision) a greater weight, inverse-variance weighting.

## Random-effects model

It might be unrealistic to assume studies in a meta-analysis are always completely homogeneous, e.g. the study of interest might be measured in different ways, or the length of exposure varies, or the target populations are not identical. In such cases there may be considerable between-study heterogeneity in the true effects. The random-effects model assumes effects of individual studies differ not only in sampling error alone but in other sources of variance.

The random-effects model assumes there is not only one true effect size but a distribution of true effect sizes, therefore the model estimates the mean of the distribution of true effects. This model does, however, give more attention to small studies when calculating the pooled effect than the fixed-effects model.

### Estimators of the Between-Study Heterogeneity

## 

Due to the lack of study homogeneity a random-effects model is preferred, however for comparison, models will be run with both fixed- and random-effects.

# Definition of R model terms

TE = specifies the effect size variable lower = specifies variable that contains the lower limit of confidence interval upper = specifies variable that contains the upper limit of confidence interval studlab = study/article label sm = summary measure common = indicates a fixed-effects model should be run random = indicates a random-effects model should be run method.tau = defines the r2 estimator method.random.ci - controls how confidence internals should be calculated when using the random-effects model data = data table to undertake analysis with

# Packages and Libraries {.unlisted .hidden}

```{r}
#| title: Libraries
#| include: false

if (!require("pacman")) install.packages("pacman"); library(pacman)

pacman::p_load(quarto, knitr, tidyverse, dplyr, reshape2, ggplot2, meta, metasens) # Install & load packages
```

# Data Wrangling
## Create data table {.unlisted .hidden}
```{r}
review_data <- tibble(
  study = c("Chiu et al. (2016)", "Chiu et al. (2016)", "Guilbert et al. (2023)", 
            "Harris et al. (2015)", "Harris et al. (2015)", "Harris et al. (2015)", 
            "Holm et al. (2023)", "Hsu et al. (2024)", "Kusters et al. (2022)", 
            "Kusters et al. (2022)", "Ni et al. (2022)", "Ni et al. (2022)", 
            "Ni et al. (2022)", "Ni et al. (2022)", "Ni et al. (2022)",
            "Ni et al. (2022)", "Porta et al. (2016)", "Sun et al. (2023)", 
            "Sun et al. (2023)", "Sun et al. (2023)", "Tokuda et al. (2023)", 
            "Tokuda et al. (2023)", "Tokuda et al. (2023)", "Tokuda et al. (2023)",
            "Wang et al. (2017)", "Whitworth et al. (2024)", "Freire et al. (2010)",
            "Freire et al. (2010)", "Guilbert et al. (2023)", "Kusters et al. (2022)",
            "Kusters et al. (2022)", "Ni et al. (2022)", "Ni et al. (2022)", 
            "Ni et al. (2022)", "Porta et al. (2016)"),
  exposure_window = c("Averaged across sensitive window", "Averaged over entire pregnancy", 
                      "Comparable data not available", "3rd trimester", "Birth‒age 6", 
                      "Year before cognitive testing", "Pregnancy", "Pregnancy",
                      "Pregnancy", "Childhood", "1st trimester", "2nd trimester", 
                      "3rd trimester", "Pregnancy", "0–2 years", "2–4 years", "Pregnancy",
                      "1st trimester", "2nd trimester", "3rd trimester", "Pregnancy", 
                      "0–1 year", "1–3 years", "3–5 years", "Age 9–11 years", 
                      "Age 3.5–4.1 years", "Childhood", "Childhood", 
                      "Comparable data not available", "Pregnancy", "Childhood", 
                      "1st trimester", "2nd trimester", "3rd trimester", "Pregnancy"),
  exposure_level = c("Change in full-scale IQ per unit increase", 
                     "Change in full-scale IQ per unit increase", "NA", 
                     "per 3.8 μg/m3 increase", "per 2.1 μg/m3 increase", 
                     "per 2.5 μg/m3 increase", "per 3 μg/m3 increase", 
                     "per 1 μg/m3 increase", "per 5 μg/m3 increase", "per 5 μg/m3 increase",
                     "per 2 μg/m3 increase", "per 2 μg/m3 increase", "per 2 μg/m3 increase",
                     "per 2 μg/m3 increase", "per 2 μg/m3 increase", "per 2 μg/m3 increase",
                     "per 10 μg/m3 increase", "per 5 μg/m3 increase", 
                     "per 5 μg/m3 increase", "per 5 μg/m3 increase", "NA", "NA", "NA", "NA",
                     "per 7.3 μg/m3 increase", "per 5 μg/m3 increase", "15.40-24.75",
                     ">24.75", "NA", "per 10μg/m3 increase", "per 10μg/m3 increase", 
                     "per 2 ppb NO2", "per 2 ppb NO2", "per 2 ppb NO2", 
                     "per 10 μg/m3 increase"),
  standardisation_factor = c(10, 10, NA, 3.8, 2.1, 2.5, 3, 10, 5, 5, 2, 2, 2, 2, 2, 2, 1, 5,
                             5, 5, NA, NA, NA, NA, 7.3, 5, NA, NA, NA, 1, 1, 2, 2, 2, 10),
  exposure = c("PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5",
              "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5",
              "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5", "PM2.5",
              "PM2.5", "PM2.5", "NO2", "NO2", "NO2", "NO2", "NO2", "NO2", "NO2", "NO2",
              "NO2"),
  effect_size = c(-0.65, -1.02, NA, -0.20, 0.70, 1.10, -1.79, -0.35, 0.77, 1.18, 0.80,
                  -0.48, -0.17, 0.18, -0.80, -2.18, -1.90, 1.34, 0.18, 0.16, 0.66, 1.00,
                  1.02, 0.79, -2.00, 2.56, -1.07, -4.19, NA, 0.53, 0.13, 0.37, 0.16, -0.27,
                  -1.10),
  ci_lower= c(-1.41, -2.78, NA, -1.40, -0.40, 0.00, -2.98, -0.68, -2.24, -2.74, -0.01,
              -1.27, -0.88, -1.25, -3.00, -5.00, -7.90, -2.71, -0.50, -0.80, 0.30, 0.54,
              0.61, 0.44, 4.84, 1.53, -9.99, -14.02, NA, -0.28, -0.59, -0.03, -0.25, -0.67,
              -2.30),
  ci_upper = c(0.10, 0.74, NA, 1.10, 1.70, 2.20, -0.58, -0.01, 3.78, 5.10, 1.62, 0.31, 0.54,
               1.62, 1.41, 0.64, 4.10, 0.04, 0.87, 0.48, 1.45, 1.82, 1.72, 1.43, 0.84, 3.57,
               7.85, 5.64, NA, 1.34, 0.85, 0.77, 0.57, 0.13, 0.10)
)

```
## Data
```{r}
knitr::kable(review_data)
```


# Visualisations {.tabset}

# To do

-   [x] Get data from MH

-   \[\] Tidy variables in R

-   \[\] Standardised effect sizes & associated CIs

-   \[\]

# Useful links

[Doing Meta-Analysis with R: A Hands-On Guide](https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/) - very useful resource for undertaking a meta-analysis using R.

---
